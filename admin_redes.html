<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor de Contenido - Admin Panel</title>
    
    <link rel="stylesheet" href="style_admin.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <style>
        .content-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
        .content-column h3 { font-size: 1.5rem; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid var(--color-border); display: flex; align-items: center; gap: 0.5rem; }
        .content-item { display: flex; gap: 1rem; align-items: flex-start; margin-bottom: 1rem; padding: 1rem; border-radius: 8px; background-color: var(--color-surface); }
        .content-item-icon { font-size: 2rem; color: var(--color-accent); margin-top: 5px; }
        .content-item-info { flex-grow: 1; }
        .content-item-info h4 { font-size: 1.1rem; margin-bottom: 0.25rem; }
        .content-item-info p { font-size: 0.9rem; color: var(--color-text-secondary); }
        .content-item-actions { display: flex; gap: 0.5rem; }
        .content-item-actions button { background: none; border: none; color: var(--color-text-secondary); font-size: 1.2rem; cursor: pointer; padding: 0.5rem; border-radius: 50%; }
        .content-item-actions button:hover { background-color: #333; color: var(--color-text-primary); }
        .btn-primary { background-color: var(--color-accent); color: #111; text-decoration: none; padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 700; border: none; cursor: pointer; display: inline-flex; align-items: center; gap: 0.5rem; }
    </style>
</head>
<body class="aurora-bg">
    <div class="admin-layout">
        <aside class="sidebar">
            <div class="sidebar-header"><a href="admin_usuarios.html" class="logo"><i class='bx bxs-shield-alt-2'></i><span>Admin Panel</span></a></div>
            <nav class="sidebar-nav">
                <div class="nav-group-title">Principal</div>
                <ul>
                    <li><a href="estadistica.html"><i class='bx bxs-bar-chart-alt-2'></i><span>Estadísticas</span></a></li>
                    <li><a href="admin_pagos.html"><i class='bx bxs-wallet'></i><span>Pagos</span></a></li>
                    <li><a href="admin_usuarios.html"><i class='bx bxs-user-detail'></i><span>Gestión Usuarios</span></a></li>
                    <li><a href="admin_contenido.html"><i class='bx bxs-user-account'></i><span>Expediente Usuario</span></a></li>
                    <li><a href="admin_redes.html" class="active"><i class='bx bxs-video-plus'></i><span>Gestor de Contenido</span></a></li>
                </ul>
              <div class="nav-group-title">Ajustes</div>
<ul>
    <li><a href="admin_resets.html"><i class='bx bxs-key'></i><span>Recuperación</span></a></li> 
    
    <li><a href="#"><i class='bx bxs-cog'></i><span>Configuración</span></a></li>
    <li><a href="login.html"><i class='bx bx-log-out-circle'></i><span>Cerrar Sesión</span></a></li>
</ul>
            </nav>
        </aside>

        <main class="main-content">
            <header class="main-header">
                <div>
                    <h2>Gestor de Contenido</h2>
                    <p>Añade, edita o elimina los cursos y herramientas para tus usuarios.</p>
                </div>
                <button class="btn-primary" id="add-content-btn"><i class='bx bx-plus'></i> Añadir Nuevo</button>
            </header>

            <div class="content-section">
                <div class="content-grid">
                    <div class="content-column">
                        <h3><i class='bx bxs-videos'></i> Cursos</h3>
                        <div id="cursos-list"></div>
                    </div>
                    <div class="content-column">
                        <h3><i class='bx bxs-wrench'></i> Herramientas</h3>
                        <div id="herramientas-list"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="content-modal" class="modal-overlay">
        <div class="modal-content glass-card">
            <div class="modal-header">
                <h3 id="modal-title">Añadir Nuevo Contenido</h3>
                <button id="close-modal-btn" class="close-button">&times;</button>
            </div>
            <form id="content-form">
                <input type="hidden" id="content-id">
                <div class="form-group"><label for="content-type">Tipo de Contenido</label><select id="content-type"><option value="cursos">Curso</option><option value="herramientas">Herramienta</option></select></div>
                <div class="form-group"><label for="content-title">Título</label><input type="text" id="content-title" required></div>
                <div class="form-group"><label for="content-description">Descripción</label><input type="text" id="content-description" required></div>
                <div class="form-group"><label for="content-link">Enlace (URL)</label><input type="url" id="content-link" required></div>
                <div class="form-group"><label for="content-icon">Icono (<a href="https://boxicons.com/" target="_blank">ver iconos</a>)</label><input type="text" id="content-icon" placeholder="Ej: bxs-rocket" required></div>
                <button type="submit" class="btn-primary" style="width: 100%;">Guardar Contenido</button>
            </form>
        </div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const modal = document.getElementById('content-modal');
        const modalTitle = document.getElementById('modal-title');
        const form = document.getElementById('content-form');
        const addContentBtn = document.getElementById('add-content-btn');
        const closeModalBtn = document.getElementById('close-modal-btn');
        let editMode = { active: false, type: '', id: '' };

        const cargarContenido = () => { cargarTipo('cursos'); cargarTipo('herramientas'); };
        const cargarTipo = (tipo) => {
            const listElement = document.getElementById(`${tipo}-list`);
            fetch(`/api/contenido/${tipo}`, { credentials: 'include' }).then(res => res.json()).then(items => {
                listElement.innerHTML = '';
                if (items.length === 0) { listElement.innerHTML = '<p style="color: var(--color-text-secondary);">No hay contenido.</p>'; }
                items.forEach(item => { listElement.innerHTML += crearItemHtml(item, tipo); });
            });
        };
        
        const abrirModal = (modo = 'add', tipo = 'cursos', item = null) => {
            form.reset();
            editMode.active = modo === 'edit';
            if (editMode.active) {
                modalTitle.textContent = 'Editar Contenido';
                editMode.id = item.id; editMode.type = tipo;
                document.getElementById('content-id').value = item.id;
                document.getElementById('content-type').value = tipo;
                document.getElementById('content-title').value = item.titulo;
                document.getElementById('content-description').value = item.descripcion;
                document.getElementById('content-link').value = item.enlace;
                document.getElementById('content-icon').value = item.icono;
                document.getElementById('content-type').disabled = true;
            } else {
                modalTitle.textContent = 'Añadir Nuevo Contenido';
                document.getElementById('content-type').disabled = false;
            }
            modal.classList.add('visible');
        };

        const cerrarModal = () => modal.classList.remove('visible');
        const manejarSubmit = (e) => {
            e.preventDefault();
            const tipo = document.getElementById('content-type').value;
            const itemData = { titulo: document.getElementById('content-title').value, descripcion: document.getElementById('content-description').value, enlace: document.getElementById('content-link').value, icono: document.getElementById('content-icon').value };
            const url = editMode.active ? `/api/contenido/${editMode.type}/${editMode.id}` : `/api/contenido/${tipo}`;
            const method = editMode.active ? 'PUT' : 'POST';
            fetch(url, { method, headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(itemData), credentials: 'include' })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        alert(`Contenido ${editMode.active ? 'actualizado' : 'añadido'}.`);
                        cerrarModal();
                        cargarContenido();
                    } else { alert('Error al guardar.'); }
                });
        };

        const manejarClickEnLista = (e) => {
            const target = e.target.closest('button');
            if (!target) return;
            const itemElement = target.closest('.content-item');
            const id = itemElement.dataset.id;
            const tipo = itemElement.dataset.tipo;
            if (target.matches('.edit-btn')) {
                fetch(`/api/contenido/${tipo}`, { credentials: 'include' }).then(res => res.json()).then(items => {
                    const itemToEdit = items.find(i => i.id === id);
                    if(itemToEdit) abrirModal('edit', tipo, itemToEdit);
                });
            }
            if (target.matches('.delete-btn')) {
                if (confirm('¿Eliminar este contenido?')) {
                    fetch(`/api/contenido/${tipo}/${id}`, { method: 'DELETE', credentials: 'include' }).then(res => res.json()).then(data => {
                        if (data.success) { alert('Contenido eliminado.'); cargarContenido(); } 
                        else { alert('Error al eliminar.'); }
                    });
                }
            }
        };

        addContentBtn.addEventListener('click', () => abrirModal());
        closeModalBtn.addEventListener('click', cerrarModal);
        form.addEventListener('submit', manejarSubmit);
        document.getElementById('cursos-list').addEventListener('click', manejarClickEnLista);
        document.getElementById('herramientas-list').addEventListener('click', manejarClickEnLista);
        window.addEventListener('click', (e) => { if (e.target === modal) cerrarModal(); });
        
        cargarContenido();
    });

    function crearItemHtml(item, tipo) {
        const enlace = item.enlace || item.enlaceVideo || item.enlaceDescarga || '#';
        return `<div class="content-item" data-id="${item.id}" data-tipo="${tipo}"><div class="content-item-icon"><i class='bx ${item.icono || 'bxs-help-circle'}'></i></div><div class="content-item-info"><h4>${item.titulo}</h4><p>${item.descripcion}</p></div><div class="content-item-actions"><button class="edit-btn" title="Editar"><i class='bx bxs-edit'></i></button><button class="delete-btn" title="Eliminar"><i class='bx bxs-trash'></i></button></div></div>`;
    }
</script>
</body>
</html>